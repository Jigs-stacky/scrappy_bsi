<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="scraper_store_demo_1" model="scraper.store">
        <field name="name">Shurgard</field>
        <field name="url">https://www.shurgard.com/en-de</field>
        <field name="domain">1</field>
        <field name="active">True</field>
        <field name="data_type">scrapy</field>
    </record>

     <record id="scraper_field_mapping_demo_1" model="scraper.field.mapping">
        <field name="scraper_store_id" ref="scraper_store_demo_1"/>
        <field name="store_url">https://www.shurgard.com/en-de</field>
        <field name="store_plan">month</field>

        <field name="price_calulate_python_code"><![CDATA[
value_size = float(str(value_size).strip().replace(',', '.'))
per_meter_value = 0

if value_size and value_price:
    if value_size <= 1:
        per_meter_value = value_price
    else:
        per_meter_value = round(value_price / float(value_size), 2)

if isinstance(bab_product, str) and bab_product:
    cleaned = ''
    decimal_found = False

    for ch in bab_product:
        if ch.isdigit():
            cleaned += ch
        elif ch == ',' and not decimal_found:
            cleaned += '.'
            decimal_found = True
        elif ch == '.' and not decimal_found:
            cleaned += '.'
            decimal_found = True
        elif cleaned:
            break

    if cleaned:
        try:
            bab_price = float(cleaned)
            if per_meter_value and value_size != bab_price:
                result = round(bab_price * per_meter_value, 2)
            else:
                result = value_price
        except ValueError:
            result = 0
    else:
        result = 0
else:
    result = 0
        ]]></field>

        <field name="store_rent_plan_python_code"><![CDATA[
per_day_amount = 0
if plan == 'month':
    per_day_amount = round( ((price * 12) / 365),2)
 
elif plan == 'week':
    per_day_amount = round(  ((price * 52) / 365), 2)]]>
        </field>
    </record>


    <record id="field_mapping_line_demo_1" model="field.mapping.lines">
        <field name="scraper_field_mapping_id" ref="scraper_field_mapping_demo_1"/>
        <field name="json_key">pricing</field>
        <field name="target_field_id"
           ref="bsi_competitor_scraper.field_scraped_store_data_line__discounted_per_day_amount"/>

        <field name="python_code">
<![CDATA[
if isinstance(value, (int, float)):
    result = float(value)

elif isinstance(value, str):
    cleaned = ''
    for ch in value:
        if ch.isdigit():
            cleaned += ch
        elif ch == ',':
            break  # stop at comma

    if cleaned:
        result = float(cleaned)
    else:
        result = value  # keep original if no number found

else:
    result = value]]></field>
    </record>

    <record id="field_mapping_line_demo_2" model="field.mapping.lines">
        <field name="scraper_field_mapping_id" ref="scraper_field_mapping_demo_1"/>
        <field name="json_key">strikethroughPrice,pricing</field>
        <field name="target_field_id"
           ref="bsi_competitor_scraper.field_scraped_store_data_line__competitor_price"/>

        <field name="python_code">
<![CDATA[
if isinstance(value, (int, float)):
    result = float(value)

elif isinstance(value, str):
    cleaned = ''
    for ch in value:
        if ch.isdigit():
            cleaned += ch
        elif ch == ',':
            break  # stop at comma

    if cleaned:
        result = float(cleaned)
    else:
        result = value  # keep original if no number found

else:
    result = value       
        ]]></field>
    </record>


    <record id="field_mapping_line_demo_3" model="field.mapping.lines">
        <field name="scraper_field_mapping_id" ref="scraper_field_mapping_demo_1"/>
        <field name="json_key">location</field>
        <field name="target_field_id"
           ref="bsi_competitor_scraper.field_scraped_store_data_line__store_location_id"/>
    </record>

     <record id="field_mapping_line_demo_4" model="field.mapping.lines">
        <field name="scraper_field_mapping_id" ref="scraper_field_mapping_demo_1"/>
        <field name="json_key">sizeDefault</field>
        <field name="target_field_id"
           ref="bsi_competitor_scraper.field_scraped_store_data_line__competitor_product"/>
    </record>

    <record id="field_mapping_line_demo_5" model="field.mapping.lines">
        <field name="scraper_field_mapping_id" ref="scraper_field_mapping_demo_1"/>
        <field name="json_key">updated_at</field>
        <field name="target_field_id"
           ref="bsi_competitor_scraper.field_scraped_store_data_line__timestamp"/>
        <field name="python_code"><![CDATA[result = value.split("T")[0]]]></field>
    </record>
    <record id="field_mapping_line_demo_6" model="field.mapping.lines">
        <field name="scraper_field_mapping_id" ref="scraper_field_mapping_demo_1"/>
        <field name="json_key">id</field>
        <field name="target_field_id"
           ref="bsi_competitor_scraper.field_scraped_store_data_line__scrappy_id"/>
    </record>

  </odoo>
